<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">

	<title>In-App Purchase - SDKBOX</title>
        
        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link href="../../css/base.css?2" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">
        <link href="../../css/custom.css" rel="stylesheet">
        

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="http://sdkbox.com"><img src="http://www.cocos2d-x.org/s/sdkbox/SDKBOX_logo.png">Docs</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">

            <ul class="nav navbar-nav navbar-right">


            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="../..">Overview</a>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Cocos2d-x <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../cocos/">Overview</a>
</li>

                        
                            
<li >
    <a href="../../installer/">CLI Installer</a>
</li>

                        
                            
<li >
    <a href="../../qa/cocos_creator/">For Cocos Creator</a>
</li>

                        
                            
  
  <li class="dropdown-submenu">
    <a tabindex="-1" class="non-link">Plugins</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../plugins/achievement/">Achievements</a>
</li>

        
            
  

        
            
<li >
    <a href="../../plugins/adcolony/">AdColony</a>
</li>

        
            
  

        
            
<li >
    <a href="../../plugins/admob/">AdMob</a>
</li>

        
            
  

        
            
<li >
    <a href="../../plugins/agecheq/">AgeCheq</a>
</li>

        
            
  

        
            
<li >
    <a href="../../plugins/appnext/">Appnext</a>
</li>

        
            
  

        
            
<li >
    <a href="../../plugins/appodeal/">Appodeal</a>
</li>

        
            
  

        
            
<li >
    <a href="../../plugins/amazon/">Amazon</a>
</li>

        
            
  

        
            
<li >
    <a href="../../plugins/apteligent/">Apteligent</a>
</li>

        
            
  

        
            
<li >
    <a href="../../plugins/bee7/">Bee7</a>
</li>

        
            
  

        
            
<li >
    <a href="../../plugins/chartboost/">Chartboost</a>
</li>

        
            
  

        
            
<li >
    <a href="../../plugins/ethwallet/">EthWallet</a>
</li>

        
            
<li >
    <a href="../../plugins/facebook/">Facebook</a>
</li>

        
            
  

        
            
<li >
    <a href="../../plugins/gameroom/">Facebook Gameroom</a>
</li>

        
            
  

        
            
<li >
    <a href="../../plugins/firebase/">Firebase</a>
</li>

        
            
  

        
            
<li >
    <a href="../../plugins/flurryanalytics/">Flurry Analytics</a>
</li>

        
            
  

        
            
<li >
    <a href="../../plugins/fyber/">Fyber</a>
</li>

        
            
  

        
            
<li >
    <a href="../../plugins/googleanalytics/">Google Analytics</a>
</li>

        
            
  

        
            
<li >
    <a href="../../plugins/googleplay/">Google Play Games</a>
</li>

        
            
  

        
            
<li >
    <a href="../../plugins/hms/">Huawei Mobile Services</a>
</li>

        
            
  

        
            
<li >
    <a href="../../plugins/iap/">In-App Purchase</a>
</li>

        
            
  

        
            
<li >
    <a href="../../plugins/inmobi/">InMobi</a>
</li>

        
            
  

        
            
<li >
    <a href="../../plugins/kochava/">Kochava</a>
</li>

        
            
  

        
            
<li >
    <a href="../../plugins/leadbolt/">LeadBolt</a>
</li>

        
            
  

        
            
<li >
    <a href="../../plugins/leaderboard/">Leaderboard</a>
</li>

        
            
  

        
            
<li >
    <a href="../../plugins/misc/">Misc</a>
</li>

        
            
  

        
            
<li >
    <a href="../../plugins/onesignal/">OneSignal</a>
</li>

        
            
  

        
            
<li >
    <a href="../../plugins/playphone/">Playphone</a>
</li>

        
            
  

        
            
<li >
    <a href="../../plugins/phunwareads/">Phunware Ads</a>
</li>

        
            
  

        
            
<li >
    <a href="../../plugins/phunwaremessaging/">Phunware Messaging</a>
</li>

        
            
  

        
            
<li >
    <a href="../../plugins/review/">Ratings & Reviews</a>
</li>

        
            
  

        
            
<li >
    <a href="../../plugins/sdkboxads/">SDKBOX Ads</a>
</li>

        
            
  

        
            
<li >
    <a href="../../plugins/sdkboxplay/">SDKBOX Play</a>
</li>

        
            
  

        
            
<li >
    <a href="../../plugins/share/">Social Sharing</a>
</li>

        
            
  

        
            
<li >
    <a href="../../plugins/signinwithapple/">Sign in with Apple</a>
</li>

        
            
  

        
            
<li >
    <a href="../../plugins/tapcore/">Tapcore</a>
</li>

        
            
  

        
            
<li >
    <a href="../../plugins/tune/">Tune</a>
</li>

        
            
  

        
            
<li >
    <a href="../../plugins/unityads/">UnityAds</a>
</li>

        
            
  

        
            
<li >
    <a href="../../plugins/valuepotion/">Valuepotion</a>
</li>

        
            
  

        
            
<li >
    <a href="../../plugins/vungle/">Vungle</a>
</li>

        
            
  

        
            
<li >
    <a href="../../plugins/youtube/">Youtube</a>
</li>

        
            
  

        
    </ul>
  </li>
  

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Unity <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../allinone/">SDKBOX AllInOne</a>
</li>

                        
                            
<li class="active">
    <a href="./">In-App Purchase</a>
</li>

                        
                            
<li >
    <a href="../review/">Ratings & Reviews</a>
</li>

                        
                            
<li >
    <a href="../socialshare/">SocialShare</a>
</li>

                        
                            
<li >
    <a href="../googleanalytics/">Google Analytics</a>
</li>

                        
                            
<li >
    <a href="../sdkboxplay/">SDKBOX Play</a>
</li>

                        
                            
<li >
    <a href="../addeals/">AdDeals</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Unreal <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../unreal/iap/">In-App Purchase</a>
</li>

                        
                            
<li >
    <a href="../../unreal/chartboost/">Chartboost</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">LiveOps <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../liveops/">Setup</a>
</li>

                        
                            
<li >
    <a href="../../liveops/remote-config/">Remote Configuration</a>
</li>

                        
                            
<li >
    <a href="../../liveops/receipt-verification/">Server-side IAP receipt verification</a>
</li>

                        
                            
<li >
    <a href="../../liveops/catalog-management/">On-the-fly catalog management</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Tutorials <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../qa/install_sdkbox/">Install SDKBox</a>
</li>

                        
                            
<li >
    <a href="../../qa/from-google-to-amazon/">From Google to Amazon</a>
</li>

                        
                            
<li >
    <a href="../../qa/integration-admob-to-creator/">Admob in Creator</a>
</li>

                        
                            
<li >
    <a href="../../qa/integration-fyber-to-cocos/">Fyber with Cocos2d-x</a>
</li>

                        
                            
<li >
    <a href="../../qa/fb-share-on-cocos/">Facebook with Cocos2d-x</a>
</li>

                        
                            
<li >
    <a href="../../qa/android_64k/">Fix Android 64K methods limit</a>
</li>

                        
                            
<li >
    <a href="../../qa/integration-iap-on-unity/">IAP with Unity</a>
</li>

                        
                            
<li >
    <a href="../../qa/use-gui-integration-ga-to-creator/">GA with SDKBox GUI in Creator</a>
</li>

                        
                            
<li >
    <a href="../../qa/use-custom-activity-on-unity/">Unity Custom Activity</a>
</li>

                        
                            
<li >
    <a href="../../qa/crypt-sdkbox-config/">Encrypt Decrypt sdkbox_config.json</a>
</li>

                        
                            
<li >
    <a href="../../qa/sdkboxplay_troubleshoot/">SDKBoxPlay Troubleshoot</a>
</li>

                        
                            
<li >
    <a href="../../qa/iap_troubleshoot/">IAP Troubleshoot</a>
</li>

                        
                            
<li >
    <a href="../../qa/sdkbox-cmake/">CMake</a>
</li>

                        
                            
<li >
    <a href="../../qa/cmake_xcframework/">CMake With XCFramework</a>
</li>

                        
                            
<li >
    <a href="../../qa/faq/">FAQ</a>
</li>

                        
                            
<li >
    <a href="../../qa/SDKBox_Shutdown_Announcement/">SDKBox Shutdown Announcement</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li >
                        <a href="../../release-note/">About</a>
                    </li>
                
                

                <li style="margin-left:30px">
                    <a href="http://sdkbox-doc.github.io/zh/">中文</a>
                </li>
                
                </ul>
            




            </ul>
        </div>
    </div>
</div>

        <div class="container">
            
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#setting-up-app-store-accounts">Setting up App Store accounts</a></li>
	
    
        <li class="main "><a href="#importing-sdkbox-iap">Importing SDKBOX IAP</a></li>
	
    
        <li class="main "><a href="#specifying-a-key-android">Specifying a key (Android)</a></li>
	
    
        <li class="main "><a href="#making-purchases">Making Purchases</a></li>
	
    
        <li class="main "><a href="#handling-callbacks">Handling Callbacks</a></li>
	
    
        <li class="main "><a href="#handling-iap-events">Handling IAP Events</a></li>
	
    
        <li class="main "><a href="#product-class">Product Class</a></li>
	
    
        <li class="main "><a href="#additional-android-instructions">Additional Android Instructions</a></li>
	
	<ul class="sub-sidenav">
        
            <li><a href="#override-unity-activity">Override Unity Activity</a></li>
        
            <li><a href="#adding-vendor-billing-permission">Adding Vendor Billing Permission</a></li>
        
            <li><a href="#faq">FAQ</a></li>
        
	</ul>
	
    
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<p><img alt="" src="./SDKBOX_logo.png" /></p>
<h1>In App Purchase Documentation.</h1>

<p>For more information, visit our website @ <a href="http://cocos2d-x.org/sdkbox">www.sdkbox.com</a></p>
<h2 id="setting-up-app-store-accounts">Setting up App Store accounts</h2>
<p>The first step of implementing In app purchase will be setting up App Store Accounts.</p>
<p>This guide does not cover creating the account itself, or creating apps in the iTunes or GooglePlay stores. For instructions on how to do that, please visit <a href="http://itunesconnect.apple.com/">iTunes</a> and <a href="https://play.google.com/apps/publish">GooglePlay</a> website.</p>
<blockquote>
<p>For GooglePlay, you must specify the public key in the IAP configuration inspector panel. You can get it from the Google Play Console "Services &amp; APIs" section</p>
</blockquote>
<h2 id="importing-sdkbox-iap">Importing SDKBOX IAP</h2>
<p>To begin using SDKBOX IAP, import the <code>sdkbox_iap</code> unity package into your project. This will add a directory under Assets called <code>SDKBOX</code>.</p>
<p><img alt="" src="./iap_dox1.png" /></p>
<p>This directory contains everything you will need in order to make In-App-Purchases. We also provide a sample scene with everything setup, you can use it as a reference</p>
<p><img alt="" src="./sample_scene.png" /></p>
<p>To begin, find the IAP prefab in the IAP directory.</p>
<p><img alt="" src="./iap_dox2.png" /></p>
<p>Create an instance of the IAP prefab in the scene where you want to make in app purchases, such as your store scene.</p>
<p>Select the IAP game object in the hierarchy and in your inspector pane you can configure the object for In-App-Purchases.</p>
<h2>Adding Products</h2>

<p>Products are added on either iTunes connect for Apple, or Google Play Portal for Google. Follow directions <insert links> on how to setup products for Apple and Google platforms.</p>
<p>Each product will have a name, and there are two types of products. Consumable and Non-consumable. Google only supports the latter, but SDKBOX allows you to have Consumable products on Google as well as Apple, and they behave the same way.</p>
<p>In the <code>Products</code> field for each platform, you can specify how many products you have, and you can enter the name of each product, and whether or not it is consumable.</p>
<blockquote>
<p>Note: you can use same name across ios and android to keep your code cross-platform</p>
</blockquote>
<p><img alt="" src="./iap_dox4.jpg" /></p>
<h2 id="specifying-a-key-android">Specifying a key (Android)</h2>
<p><img alt="" src="./iap_dox3.jpg" /></p>
<p>On Android, need a license key from the <code>Services &amp; APIs</code> section of the Google Play Developer Console. Copy and paste this key into the Android Key field.</p>
<h2 id="making-purchases">Making Purchases</h2>
<p>Making a purchase is as simple as invoking the <code>purchase</code> method on the IAP game object. There are several ways to do this, we will do it by adding a button.</p>
<p>From the menu, choose <strong>Game Object</strong> -&gt; <strong>UI</strong> -&gt; <strong>Button</strong>. This will create a UI canvas (if you didn't have one already) and add a button.</p>
<p><img alt="" src="./iap_dox5.jpg" /></p>
<p>Name your button in the hierarchy what you like, and change the text to "Purchase" or something similar.</p>
<p>Now in the inspector pane, find the <code>On Click()</code> event and from the object drop down, select the IAP game object. Then from the method drop down, select the <code>IAP.purchase</code> method.</p>
<p>This method takes a string argument that is the name of the product being purchased. You can enter that name under the method name in the space provided.</p>
<p><img alt="" src="./iap_dox6.jpg" /></p>
<h2 id="handling-callbacks">Handling Callbacks</h2>
<p>There are several events that provide feedback about what is happening when you initialize, make purchases, or restore previously purchased items.</p>
<p>The following is a list of the callbacks and the parameters they provide.</p>
<ul>
<li>
<p><code>onInitialized (bool status)</code> Called after the IAP system initializes. It will pass a boolean value that indicates whether or not the initialization was successful or not. A value of <code>true</code> indicates success.</p>
</li>
<li>
<p><code>onProductRequestSuccess (Product[] products)</code> Called after initialization, and having requested the products from the store using the keys specified for each platform. If the request was successful, then this callback is invoked and passed the array of available products.</p>
</li>
<li>
<p><code>onProductRequestFailure (string error)</code> Called after initialization, and if a product request fails. The string will contain an error message.</p>
</li>
<li>
<p><code>onSuccess (Product product)</code> Called after a successful purchase. The product is supplied as an argument. See <code>Product</code> for more details.</p>
</li>
<li>
<p><code>onFailure (Product product, string error)</code> Called after a failed purchase attempt. The product is supplied as an argument, and a string is passed containing an error message.</p>
</li>
<li>
<p><code>onCanceled (Product product)</code> Called if a In-App-Purchase is canceled. The product is supplied as an argument.</p>
</li>
<li>
<p><code>onRestored (Product product)</code> Called for each product restored from the store. If no products have been purchased, then you will only get the following completed call.</p>
</li>
<li>
<p><code>onRestoreComplete ()</code> Called after all products have been restored. If none were restored, you will still receive this callback.</p>
</li>
</ul>
<h2 id="handling-iap-events">Handling IAP Events</h2>
<p>Similar to the button On Click() event, you can subscribe to SDKBOX IAP events to get feedback about the IAP process, and to receive products from the IAP store.</p>
<p>In the <code>Callbacks</code> section of the IAP script inspector pane, you can click <code>+</code> to add a subscriber, and specify the object, and method that you would like to have invoked.</p>
<p><img alt="" src="./iap_dox7.jpg" /></p>
<h2 id="product-class">Product Class</h2>
<pre><code>    public struct Product
    {
        public enum Type {CONSUMABLE, NON_CONSUMABLE};

        // The name specified in sdkbox_config.json
        public string name;

        // The product id of an In App Purchase
        public string id;

        // Type of iap item
        public Type type;

        // The title of the IAP item
        public string title;

        // The description of the IAP item
        public string description;

        // Price value in float
        public float priceValue;

        // Localized price
        public string price;

        // price currency code
        public string currencyCode;
    }
</code></pre>

<p>The product class contains all the information about a product retrieved from the server, as well as the consumable state set in the editor.</p>
<p>You should not create your own products, but rather allow SDKBOX IAP to create them for you.</p>
<h2 id="additional-android-instructions">Additional Android Instructions</h2>
<h3 id="override-unity-activity">Override Unity Activity</h3>
<p>In order for In-App-Purchase to work, we have to be able to forward certain activity methods to the billing code. To do this on Unity we have to replace the Unity main activity. If you do not have your own custom activity, and also have not provided your own AndroidManifest.xml, then the package will automatically copy the activity and manifest to the correct location. If there is already a manifest present, then it will notify you with a dialog to read this section and perform the following steps.</p>
<ol>
<li>Copy the file <em>CustomActivity.jar</em> from <strong>Assets/SDKBOX/Assets/Resources</strong> to <strong>Assets/Plugins/Android</strong></li>
<li>Modify your AndroidManifest.xml as following:
<img alt="" src="./chart-8.png" /></li>
</ol>
<h3 id="adding-vendor-billing-permission">Adding Vendor Billing Permission</h3>
<p>In order for In-App-Purchase to work on Android, it needs the following permission to be added.</p>
<pre><code>&lt;uses-permission android:name=&quot;com.android.vending.BILLING&quot; /&gt;
</code></pre>

<p>If you have not specified your own AndroidManifest.xml then when you import the package, one will be copied that already has this permission set.</p>
<p>If you do have your own already, then you will need to add this permission to it.</p>
<p>The AndroidManifest.xml is merged with the main manifest that Unity creates when building the APK.</p>
<h3 id="faq">FAQ</h3>
<ol>
<li>Found plugins with same names and architectures
Sometimes Unity failed to recognize Android library correctly, when that happens you'll encounter this error message.
<img alt="" src="./error_1_arch.png" /></li>
</ol>
<p>To fix this issue, select the *.so files based on the error message, then check the Inspector, make sure the "Platform Settings" are correct.
Anything under "x86" folder, should be set to "x86". Anything under "armeabi-v7a" folder should be set to "ARMv7"
<img alt="" src="./error_1_solve.png" /></p></div>
            
        </div>

        <footer class="col-md-12">
            <hr>
            
            <p>Build Date UTC :2021-11-29 06:34:07.479519, Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>

        
        <script src="../../js/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/highlight.pack.js"></script>
        <script>var base_url = '../..';</script>
        <script src="../../js/base.js"></script>
        


        
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-70044300-2', 'auto');
            ga('send', 'pageview');
        </script>
        
    </body>
</html>
