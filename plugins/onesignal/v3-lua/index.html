<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../../img/favicon.ico">

	<title>OneSignal with Lua - SDKBOX</title>
        
        <link href="../../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link href="../../../css/base.css?2" rel="stylesheet">
        <link rel="stylesheet" href="../../../css/highlight.css">
        <link href="../../../css/custom.css" rel="stylesheet">
        

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="http://sdkbox.com"><img src="http://www.cocos2d-x.org/s/sdkbox/SDKBOX_logo.png">Docs</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">

            <ul class="nav navbar-nav navbar-right">


            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="../../..">Overview</a>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Cocos2d-x <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../../cocos/">Overview</a>
</li>

                        
                            
<li >
    <a href="../../../installer/">CLI Installer</a>
</li>

                        
                            
<li >
    <a href="../../../qa/cocos_creator/">For Cocos Creator</a>
</li>

                        
                            
  
  <li class="dropdown-submenu">
    <a tabindex="-1" class="non-link">Plugins</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../achievement/">Achievements</a>
</li>

        
            
  

        
            
<li >
    <a href="../../adcolony/">AdColony</a>
</li>

        
            
  

        
            
<li >
    <a href="../../admob/">AdMob</a>
</li>

        
            
  

        
            
<li >
    <a href="../../agecheq/">AgeCheq</a>
</li>

        
            
  

        
            
<li >
    <a href="../../appnext/">Appnext</a>
</li>

        
            
  

        
            
<li >
    <a href="../../appodeal/">Appodeal</a>
</li>

        
            
  

        
            
<li >
    <a href="../../amazon/">Amazon</a>
</li>

        
            
  

        
            
<li >
    <a href="../../apteligent/">Apteligent</a>
</li>

        
            
  

        
            
<li >
    <a href="../../bee7/">Bee7</a>
</li>

        
            
  

        
            
<li >
    <a href="../../chartboost/">Chartboost</a>
</li>

        
            
  

        
            
<li >
    <a href="../../facebook/">Facebook</a>
</li>

        
            
  

        
            
<li >
    <a href="../../gameroom/">Facebook Gameroom</a>
</li>

        
            
  

        
            
<li >
    <a href="../../firebase/">Firebase</a>
</li>

        
            
  

        
            
<li >
    <a href="../../flurryanalytics/">Flurry Analytics</a>
</li>

        
            
  

        
            
<li >
    <a href="../../fyber/">Fyber</a>
</li>

        
            
  

        
            
<li >
    <a href="../../googleanalytics/">Google Analytics</a>
</li>

        
            
  

        
            
<li >
    <a href="../../googleplay/">Google Play Games</a>
</li>

        
            
  

        
            
<li >
    <a href="../../iap/">In-App Purchase</a>
</li>

        
            
  

        
            
<li >
    <a href="../../inmobi/">InMobi</a>
</li>

        
            
  

        
            
<li >
    <a href="../../kochava/">Kochava</a>
</li>

        
            
  

        
            
<li >
    <a href="../../leadbolt/">LeadBolt</a>
</li>

        
            
  

        
            
<li >
    <a href="../../leaderboard/">Leaderboard</a>
</li>

        
            
  

        
            
<li >
    <a href="../">OneSignal</a>
</li>

        
            
  

        
            
<li >
    <a href="../../playphone/">Playphone</a>
</li>

        
            
  

        
            
<li >
    <a href="../../phunwareads/">Phunware Ads</a>
</li>

        
            
  

        
            
<li >
    <a href="../../phunwaremessaging/">Phunware Messaging</a>
</li>

        
            
  

        
            
<li >
    <a href="../../review/">Ratings & Reviews</a>
</li>

        
            
  

        
            
<li >
    <a href="../../sdkboxads/">SDKBOX Ads</a>
</li>

        
            
  

        
            
<li >
    <a href="../../sdkboxplay/">SDKBOX Play</a>
</li>

        
            
  

        
            
<li >
    <a href="../../share/">Social Sharing</a>
</li>

        
            
  

        
            
<li >
    <a href="../../tapcore/">Tapcore</a>
</li>

        
            
  

        
            
<li >
    <a href="../../tune/">Tune</a>
</li>

        
            
  

        
            
<li >
    <a href="../../unityads/">UnityAds</a>
</li>

        
            
  

        
            
<li >
    <a href="../../valuepotion/">Valuepotion</a>
</li>

        
            
  

        
            
<li >
    <a href="../../vungle/">Vungle</a>
</li>

        
            
  

        
            
<li >
    <a href="../../youtube/">Youtube</a>
</li>

        
            
  

        
    </ul>
  </li>
  

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Unity <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../../unity/allinone/">SDKBOX AllInOne</a>
</li>

                        
                            
<li >
    <a href="../../../unity/iap/">In-App Purchase</a>
</li>

                        
                            
<li >
    <a href="../../../unity/review/">Ratings & Reviews</a>
</li>

                        
                            
<li >
    <a href="../../../unity/socialshare/">SocialShare</a>
</li>

                        
                            
<li >
    <a href="../../../unity/googleanalytics/">Google Analytics</a>
</li>

                        
                            
<li >
    <a href="../../../unity/sdkboxplay/">SDKBOX Play</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Unreal <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../../unreal/iap/">In-App Purchase</a>
</li>

                        
                            
<li >
    <a href="../../../unreal/chartboost/">Chartboost</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">LiveOps <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../../liveops/">Setup</a>
</li>

                        
                            
<li >
    <a href="../../../liveops/remote-config/">Remote Configuration</a>
</li>

                        
                            
<li >
    <a href="../../../liveops/receipt-verification/">Server-side IAP receipt verification</a>
</li>

                        
                            
<li >
    <a href="../../../liveops/catalog-management/">On-the-fly catalog management</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Tutorials <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../../qa/from-google-to-amazon/">From Google to Amazon</a>
</li>

                        
                            
<li >
    <a href="../../../qa/integration-admob-to-creator/">Admob in Creator</a>
</li>

                        
                            
<li >
    <a href="../../../qa/integration-fyber-to-cocos/">Fyber with Cocos2d-x</a>
</li>

                        
                            
<li >
    <a href="../../../qa/fb-share-on-cocos/">Facebook with Cocos2d-x</a>
</li>

                        
                            
<li >
    <a href="../../../qa/android_64k/">Fix Android 64K methods limit</a>
</li>

                        
                            
<li >
    <a href="../../../qa/integration-iap-on-unity/">IAP with Unity</a>
</li>

                        
                            
<li >
    <a href="../../../qa/use-gui-integration-ga-to-creator/">GA with SDKBox GUI in Creator</a>
</li>

                        
                            
<li >
    <a href="../../../qa/use-custom-activity-on-unity/">Unity Custom Activity</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li >
                        <a href="../../../release-note/">About</a>
                    </li>
                
                

                <li style="margin-left:30px">
                    <a href="http://sdkbox-doc.github.io/zh/">中文</a>
                </li>
                
                </ul>
            




            </ul>
        </div>
    </div>
</div>

        <div class="container">
            
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#integration">Integration</a></li>
	
	<ul class="sub-sidenav">
        
            <li><a href="#ios-precondition">iOS precondition</a></li>
        
            <li><a href="#android-precondition">Android precondition</a></li>
        
	</ul>
	
    
        <li class="main "><a href="#important-notice">Important Notice</a></li>
	
	<ul class="sub-sidenav">
        
            <li><a href="#disable-app-transport-security">Disable App Transport Security</a></li>
        
            <li><a href="#disable-bitcode-support">Disable Bitcode support</a></li>
        
            <li><a href="#set-your-game-requires-full-screen">Set your game requires full screen</a></li>
        
            <li><a href="#whitelist-canopenurl-function">Whitelist canOpenURL function</a></li>
        
            <li><a href="#json-configuration">JSON Configuration</a></li>
        
	</ul>
	
    
        <li class="main "><a href="#optional">Optional</a></li>
	
	<ul class="sub-sidenav">
        
            <li><a href="#usage">Usage</a></li>
        
            <li><a href="#api-reference">API Reference</a></li>
        
            <li><a href="#manual-integration">Manual Integration</a></li>
        
            <li><a href="#manual-integration-for-ios">Manual Integration For iOS</a></li>
        
            <li><a href="#manual-integration-for-android">Manual Integration For Android</a></li>
        
            <li><a href="#manual-integration-for-google-play-services-sdk-dependent-library-only">Manual Integration for Google Play Services SDK (dependent library only)</a></li>
        
            <li><a href="#proguard-optional">Proguard (optional)</a></li>
        
	</ul>
	
    
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<p><a href="../">&#8249; OneSignal Doc Home</a></p>
<h1>OneSignal Integration Guide</h1>

<h4><em><b>For the Lua version of cocos2d-x v3.x</b> - (<a href="./../">all other versions</a>)</em></h4>

<h2 id="integration">Integration</h2>
<p>First, you must sign up for <a href="https://onesignal.com/">OneSignal</a>.</p>
<p>Second, Open a terminal and use the following command to install the SDKBOX OneSignal plugin.</p>
<pre><code class="bash">$ sdkbox import onesignal
</code></pre>

<p>For Android, you need more steps:</p>
<ol>
<li>Replace all 3 of instances <strong>manifestApplicationId</strong> with your package name in AndroidManifest.xml.</li>
</ol>
<p>Third,</p>
<h3 id="ios-precondition">iOS precondition</h3>
<ul>
<li><a href="https://documentation.onesignal.com/docs/generate-an-ios-push-certificate">iOS Configuration</a></li>
<li><a href="https://documentation.onesignal.com/docs/troubleshooting-ios">iOS FAQ</a></li>
</ul>
<h3 id="android-precondition">Android precondition</h3>
<ul>
<li><a href="https://documentation.onesignal.com/docs/generate-a-google-server-api-key">Android Configuration</a></li>
<li><a href="https://documentation.onesignal.com/docs/troubleshooting-android">Android FAQ</a></li>
</ul>
<h2 id="important-notice">Important Notice</h2>
<p>Please make sure the following settings in your project to make the plugin work well.</p>
<h4 id="disable-app-transport-security">Disable App Transport Security</h4>
<p>Adding the following entry to the <code>info.plist</code> file:</p>
<pre><code>&lt;key&gt;NSAppTransportSecurity&lt;/key&gt;
&lt;dict&gt;
    &lt;key&gt;NSAllowsArbitraryLoads&lt;/key&gt;
    &lt;true/&gt;
&lt;/dict&gt;
</code></pre>

<p>It should look like this:</p>
<p><img alt="" src="../../../imgs/ATS.png" /></p>
<h4 id="disable-bitcode-support">Disable Bitcode support</h4>
<p>You have to turn off <strong>Bitcode</strong> support. If you don't, cocos2d-x will fail to build.</p>
<h4 id="set-your-game-requires-full-screen">Set your game requires full screen</h4>
<p>If your game doesn't support all screen orientations, you will need to check <code>Requires full screen</code> in Xcode. If you do not, your app will fail Apple's submission process.</p>
<h4 id="whitelist-canopenurl-function">Whitelist canOpenURL function</h4>
<p>This setting depends on what plugins are in your project. You may need to add the required entry to the <code>info.plist</code>, under <code>LSApplicationQueriesSchemes</code>.</p>
<!--## Configuration

## Remote Configuration

Optionally, you can choose to use SDKBOX LiveOps to remotely update this plugin's configuration. [Learn more](/liveops/remote-config)-->

<h3 id="json-configuration">JSON Configuration</h3>
<p>SDKBOX Installer will automatically inject a sample configuration to your <code>sdkbox_config.json</code>, that you have to modify it before you can use it for your own app</p>
<p>"id": [string] App Id</p>
<p>"project_number": [string] Google Project Number (Android only)</p>
<h1 id="optional">Optional</h1>
<p>"auto_register": [bool] Enable auto register (iOS only)</p>
<p>"vibrate": [bool] Enable vibrate (Android only)</p>
<p>"sound": [bool] Enable sound (Android only)</p>
<p>"notifications_when_active": [bool] Enable notifications when active (Android only)</p>
<p>Example:</p>
<pre><code class="json">
{
    &quot;ios&quot;: {
        &quot;OneSignal&quot;:{
            &quot;debug&quot;:false,
            &quot;id&quot;:&quot;9a4c9936-62e8-4473-9456-77c50d551870&quot;,
            &quot;auto_register&quot;:true
        }
    },
    &quot;android&quot;: {
        &quot;OneSignal&quot;:{
            &quot;debug&quot;:false,
            &quot;id&quot;:&quot;9a4c9936-62e8-4473-9456-77c50d551870&quot;,
            &quot;project_number&quot;:&quot;517386718969&quot;,
            &quot;vibrate&quot;:true,
            &quot;sound&quot;:true,
            &quot;notifications_when_active&quot;:false
        }
    }
}

</code></pre>

<h2 id="usage">Usage</h2>
<h3 id="initialize-onesignal">Initialize OneSignal</h3>
<ul>
<li>modify your Lua code to <code>init()</code> the plugin. This can be done anyplace, however it must be done before trying to use the plugin's features.</li>
</ul>
<pre><code class="lua">sdkbox.PluginOneSignal:init()
</code></pre>

<h3 id="tag-a-user-based-on-an-app-event-of-your-choosing-so-later-you-can-create-segments-on-onesignalcom-to-target-these-users">Tag a user based on an app event of your choosing so later you can create segments on onesignal.com to target these users.</h3>
<pre><code class="lua">sdkbo.PluginOneSignal::sendTag(&quot;key&quot;, &quot;value&quot;);
</code></pre>

<h3 id="retrieve-a-list-of-tags-that-have-been-set-on-the-user-from-the-onesignal-server">Retrieve a list of tags that have been set on the user from the OneSignal server.</h3>
<pre><code class="lua">sdkbo.PluginOneSignal::getTags();
</code></pre>

<h3 id="deletes-a-tag-that-was-previously-set-on-a-user-with-sendtag">Deletes a tag that was previously set on a user with sendTag</h3>
<pre><code class="lua">sdkbo.PluginOneSignal::deleteTag(&quot;key&quot;);
</code></pre>

<h3 id="lets-you-retrieve-the-onesignal-user-id-and-push-token">Lets you retrieve the OneSignal user id and push token.</h3>
<pre><code class="lua">sdkbo.PluginOneSignal::idsAvailable();
</code></pre>

<h3 id="you-can-call-this-method-with-false-to-opt-users-out-of-receiving-all-notifications-through-onesignal">You can call this method with false to opt users out of receiving all notifications through OneSignal.</h3>
<pre><code class="lua">sdkbo.PluginOneSignal::setSubscription(true);
</code></pre>

<h3 id="allows-you-to-send-notifications-from-user-to-user-or-schedule-ones-in-the-future-to-be-delivered-to-the-current-device">Allows you to send notifications from user to user or schedule ones in the future to be delivered to the current device.</h3>
<p>You must build a json string for the API, you can use
- rapidjson
- picojson</p>
<p>See OneSignal <a href="https://documentation.onesignal.com/v2.0/docs/notifications-create-notification">create notification POST</a> call for all options.</p>
<p>Here is a picojson example:</p>
<pre><code class="lua">local data = {
    contents = {
        en = &quot;Test Message&quot;
    },
    data = {
        foo = &quot;bar&quot;
    },
    include_player_ids = {
        &quot;5ea075c5-016d-4f55-891c-3b6c4b393e49&quot;,
        &quot;4db7cb0f-daca-49d6-b3dd-a96774de9f72&quot;,
        &quot;33ad9d96-df00-42a2-b5ab-73417f777d42&quot;,&quot;5ea075c5-016d-4f55-891c-3b6c4b393e49&quot;
    }
}
require &quot;json&quot;
sdkbo.PluginOneSignal::postNotification(json.encode(data));
</code></pre>

<h3 id="implement-onesignallistner">Implement OneSignalListner</h3>
<ul>
<li>You can implement OneSignalListener if you want to receive callbacks like video finish playing.</li>
</ul>
<pre><code class="lua">
sdkbox.PluginOneSignal.setListener(function(args)
    dump(args)
    local event = args.event
    if &quot;onSendTag&quot; == event then
        -- args.success, args.key, args.message
    elseif &quot;onGetTags&quot; == event then
        -- args.jsonString
        -- cjson.decode(args.jsonString)
    elseif &quot;onIdsAvailable&quot; == event then
        -- args.userId, args.pushToken
    elseif &quot;onPostNotification&quot; == event then
        -- args.success, args.message
    elseif &quot;onNotification&quot; == event then
        -- args.isActive, args.message, args.additionalData
    end
end)

</code></pre>

<h2 id="api-reference">API Reference</h2>
<h3 id="methods">Methods</h3>
<pre><code class="lua">sdkbox.PluginOneSignal:init()
</code></pre>

<blockquote>
<p>initialize the plugin instance.</p>
</blockquote>
<pre><code class="lua">sdkbox.PluginOneSignal:setListener(listener)
</code></pre>

<blockquote>
<p>Set listener to listen for onesignal events</p>
</blockquote>
<pre><code class="lua">sdkbox.PluginOneSignal:registerForPushNotifications()
</code></pre>

<blockquote>
<p>Only use if you set "auto_register":false in sdkbox_config.json (iOS only)</p>
</blockquote>
<pre><code class="lua">--[[
sdkbox.PluginOneSignal.LogLevel.None
sdkbox.PluginOneSignal.LogLevel.Fatal
sdkbox.PluginOneSignal.LogLevel.Error
sdkbox.PluginOneSignal.LogLevel.Warn
sdkbox.PluginOneSignal.LogLevel.Info
sdkbox.PluginOneSignal.LogLevel.Debug
sdkbox.PluginOneSignal.LogLevel.Verbose
]]
sdkbox.PluginOneSignal:setLogLevel(logLevel, visualLogLevel)
</code></pre>

<blockquote>
<p>Enable logging to help debug if you run into an issue setting up OneSignal. This selector
is static so you can call it before OneSignal init. The following options are available
with increasingly more information</p>
</blockquote>
<pre><code class="lua">sdkbox.PluginOneSignal:sendTag(key, value)
</code></pre>

<blockquote>
<p>Tag a user based on an app event of your choosing so later you can create segments on
onesignal.com to target these users.</p>
</blockquote>
<pre><code class="lua">sdkbox.PluginOneSignal:setEmail(email)
</code></pre>

<blockquote>
<p>Set email</p>
</blockquote>
<pre><code class="lua">sdkbox.PluginOneSignal:getTags()
</code></pre>

<blockquote>
<p>Retrieve a list of tags that have been set on the user from the OneSignal server.</p>
</blockquote>
<pre><code class="lua">sdkbox.PluginOneSignal:deleteTag(key)
</code></pre>

<blockquote>
<p>Deletes a tag that was previously set on a user with sendTag</p>
</blockquote>
<pre><code class="lua">sdkbox.PluginOneSignal:idsAvailable()
</code></pre>

<blockquote>
<p>Lets you retrieve the OneSignal user id and the Google registration id. Your handler is
called after the device is successfully registered with OneSignal.</p>
</blockquote>
<pre><code class="lua">sdkbox.PluginOneSignal:enableInAppAlertNotification(enable)
</code></pre>

<blockquote>
<p>By default this is false and notifications will not be shown when the user is in your app,
instead the NotificationOpenedHandler is fired. If set to true notifications will be shown
as native alert boxes if a notification is received when the user is in your app. The
NotificationOpenedHandler is then fired after the alert box is closed.</p>
</blockquote>
<pre><code class="lua">sdkbox.PluginOneSignal:setSubscription(enable)
</code></pre>

<blockquote>
<p>You can call this method with false to opt users out of receiving all notifications through
OneSignal. You can pass true later to opt users back into notifications.</p>
</blockquote>
<pre><code class="lua">sdkbox.PluginOneSignal:postNotification(jsonString)
</code></pre>

<blockquote>
<p>Allows you to send notifications from user to user or schedule ones in the future to be
delivered to the current device.</p>
</blockquote>
<pre><code class="lua">sdkbox.PluginOneSignal:promptLocation()
</code></pre>

<blockquote>
<p>Prompts the user for location permissions. This allows for geotagging so you can send
notifications to users based on location.</p>
</blockquote>
<h3 id="listeners">Listeners</h3>
<pre><code class="lua">onSendTag(success, key, message)
</code></pre>

<pre><code class="lua">onGetTags(jsonString)
</code></pre>

<pre><code class="lua">onIdsAvailable(userId, pushToken)
</code></pre>

<pre><code class="lua">onPostNotification(success, message)
</code></pre>

<pre><code class="lua">onNotification(isActive, message, additionalData)
</code></pre>

<h2 id="manual-integration">Manual Integration</h2>
<p>If the <em>SDKBOX Installer</em> <strong>fails</strong> to complete successfully, it is possible to integrate SDKBOX manually. If the installer complete successfully, please <strong>do not</strong> complete anymore of this document. It is not necessary.</p>
<p>These steps are listed last in this document on purpose as they are seldom needed. If you find yourself using these steps, please, after completing, double back and re-read the steps above for other integration items.</p>
<h2 id="manual-integration-for-ios">Manual Integration For iOS</h2>
<p>Drag and drop the following frameworks from the <strong>plugins/ios</strong> folder of the <code>OneSignal</code> bundle into your Xcode project, check <code>Copy items if needed</code> when
adding frameworks:</p>
<blockquote>
<p>sdkbox.framework</p>
<p>PluginOneSignal.framework</p>
<p>OneSignal.framework</p>
</blockquote>
<p>You also need to add the following system frameworks, if you don't already have them:</p>
<blockquote>
<p>SystemConfiguration.framework</p>
</blockquote>
<p>Copy all source and header files from <code>plugin/luabindings/</code> to your projects <code>Classes</code> folder.</p>
<p>Add these same files, that you just copied, to Xcode by either dragging and dropping them into Xcode or by using <strong>File -&gt; Add files to...</strong>.</p>
<h2 id="manual-integration-for-android">Manual Integration For Android</h2>
<p>SDKBOX supports three different kinds of <strong>Android</strong> projects <strong>command-line</strong>, <strong>eclipse</strong> and <strong>Android Studio</strong>. </p>
<ul>
<li><code>proj.android</code> will be used as our <code>&lt;project_root&gt;</code> for <strong>command-line</strong> and <strong>eclipse</strong> project</li>
<li><code>proj.android-studio</code> will be used as our <code>&lt;project_root&gt;</code> for <strong>Android Studio</strong> project.</li>
</ul>
<h3 id="copy-files">Copy Files</h3>
<p>Copy the everything from <code>plugin/android/libs</code> folder of this
bundle into your project’s <strong><project_root>/libs</strong> folder.</p>
<ul>
<li>If you're using cocos2d-x from source copy the <strong>jar</strong> files to:</li>
</ul>
<pre><code>cocos2d/cocos/platform/android/java/libs
</code></pre>

<ul>
<li>If you're using cocos2d-js or lua copy the <strong>jar</strong> files to:</li>
</ul>
<pre><code>frameworks/cocos2d-x/cocos/platform/android/java/libs
</code></pre>

<ul>
<li>If you're using prebuilt cocos2d-x copy the <strong>jar</strong> files to:</li>
</ul>
<pre><code>&lt;project_root&gt;/libs
</code></pre>

<h4 id="copy-jni-libs">Copy jni libs</h4>
<p>Copy and overwrite all the folders from <code>plugin/android/jni</code>
to your <code>&lt;project_root&gt;/jni/</code> directory.</p>
<blockquote>
<p>Note: SDKBOX link with <code>gnustl</code> by default, if your project link with <code>c++static</code> please replace the files in <code>&lt;project_root&gt;/jni/&lt;plugin_name&gt;/libs</code> with files in <code>&lt;project_root&gt;/jni/&lt;plugin_name&gt;/libs_c++_static</code> folder</p>
</blockquote>
<h3 id="edit-androidmanifestxml">Edit <code>AndroidManifest.xml</code></h3>
<p>Include the following permissions above the <strong>application tag</strong>:</p>
<pre><code class="xml">&lt;!--Mandatory permissions to receive ads--&gt;
&lt;uses-permission android:name=&quot;android.permission.INTERNET&quot;/&gt;
&lt;uses-permission android:name=&quot;android.permission.ACCESS_NETWORK_STATE&quot;/&gt;

&lt;permission android:name=&quot;__manifestApplicationId__.permission.C2D_MESSAGE&quot;
            android:protectionLevel=&quot;signature&quot; /&gt;
&lt;uses-permission android:name=&quot;__manifestApplicationId__.permission.C2D_MESSAGE&quot; /&gt;
&lt;uses-permission android:name=&quot;com.google.android.c2dm.permission.RECEIVE&quot; /&gt;
&lt;uses-permission android:name=&quot;android.permission.WAKE_LOCK&quot; /&gt;
&lt;uses-permission android:name=&quot;android.permission.VIBRATE&quot; /&gt;
&lt;uses-permission android:name=&quot;android.permission.ACCESS_WIFI_STATE&quot; /&gt;
&lt;uses-permission android:name=&quot;android.permission.CHANGE_WIFI_STATE&quot; /&gt;

&lt;!-- START: ShortcutBadger --&gt;
&lt;!--for Samsung--&gt;
&lt;uses-permission android:name=&quot;com.sec.android.provider.badge.permission.READ&quot;/&gt;
&lt;uses-permission android:name=&quot;com.sec.android.provider.badge.permission.WRITE&quot;/&gt;

&lt;!--for htc--&gt;
&lt;uses-permission android:name=&quot;com.htc.launcher.permission.READ_SETTINGS&quot;/&gt;
&lt;uses-permission android:name=&quot;com.htc.launcher.permission.UPDATE_SHORTCUT&quot;/&gt;

&lt;!--for sony--&gt;
&lt;uses-permission android:name=&quot;com.sonyericsson.home.permission.BROADCAST_BADGE&quot;/&gt;

&lt;!--for apex--&gt;
&lt;uses-permission android:name=&quot;com.anddoes.launcher.permission.UPDATE_COUNT&quot;/&gt;

&lt;!--for solid--&gt;
&lt;uses-permission android:name=&quot;com.majeur.launcher.permission.UPDATE_BADGE&quot;/&gt;
&lt;!-- End: ShortcutBadger --&gt;
</code></pre>

<p>Additionally, you will need to add the Kochava broadcast receiver and the
following meta-data tag between the <strong>application tags</strong>, this is needed for the Google Play referral data capture:</p>
<pre><code class="xml">&lt;meta-data
      android:name=&quot;com.google.android.gms.version&quot;
      android:value=&quot;@integer/google_play_services_version&quot; /&gt;
&lt;receiver android:name=&quot;com.onesignal.GcmBroadcastReceiver&quot;
          android:permission=&quot;com.google.android.c2dm.permission.SEND&quot; &gt;
  &lt;intent-filter&gt;
    &lt;action android:name=&quot;com.google.android.c2dm.intent.RECEIVE&quot; /&gt;
    &lt;category android:name=&quot;__manifestApplicationId__&quot; /&gt;
  &lt;/intent-filter&gt;
&lt;/receiver&gt;
&lt;receiver android:name=&quot;com.onesignal.NotificationOpenedReceiver&quot; /&gt;
&lt;service android:name=&quot;com.onesignal.GcmIntentService&quot; /&gt;
&lt;service android:name=&quot;com.onesignal.SyncService&quot; android:stopWithTask=&quot;false&quot; /&gt;
&lt;activity android:name=&quot;com.onesignal.PermissionsActivity&quot; android:theme=&quot;@android:style/Theme.Translucent.NoTitleBar&quot; /&gt;
</code></pre>

<pre><code>
### Edit `Android.mk`
Edit `&lt;project_root&gt;/jni/Android.mk` to:

Add additional requirements to __LOCAL_WHOLE_STATIC_LIBRARIES__:
</code></pre>

<p>LOCAL_WHOLE_STATIC_LIBRARIES += PluginOneSignal
LOCAL_WHOLE_STATIC_LIBRARIES += sdkbox</p>
<pre><code>
Add a call to:
</code></pre>

<p>$(call import-add-path,$(LOCAL_PATH))</p>
<pre><code>before any __import-module__ statements.

Add additional __import-module__ statements at the end:
</code></pre>

<p>$(call import-module, ./sdkbox)
$(call import-module, ./pluginonesignal)</p>
<pre><code>
This means that your ordering should look similar to this:
</code></pre>

<p>$(call import-add-path,$(LOCAL_PATH))
$(call import-module, ./sdkbox)
$(call import-module, ./pluginonesignal)</p>
<pre><code>
  __Note:__ It is important to make sure these statements are above the existing `$(call import-module,./prebuilt-mk)` statement, if you are using the pre-built libraries.

### Modify `Application.mk` (Cocos2d-x v3.0 to v3.2 only)
Edit `&lt;project_root&gt;/jni/Application.mk` to make sure __APP_STL__ is defined
correctly. If `Application.mk` contains `APP_STL := c++_static`, it should be
changed to:
</code></pre>

<p>APP_STL := gnustl_static</p>
<pre><code>


Copy all source and header files from `plugin/luabindings/` to your projects `Classes` folder.

Add all `.cpp` files, that you just copied, to `Android.mk` in the __LOCAL_SRC_FILES__ section. Example
</code></pre>

<p>LOCAL_SRC_FILES := hellocpp/main.cpp \
                ../../Classes/AppDelegate.cpp \
                ../../Classes/HelloWorldScene.cpp \
                                ../../Classes/NewSourceFile.cpp</p>
<pre><code>


### Modify __Cocos2dxActivity.java__
* If you're using cocos2d-x from source, assuming you are in the __proj.android__ directory, __Cocos2dxActivity.java__ is located:

    ```
    ../../cocos2d-x/cocos/platform/android/java/src/org/cocos2dx/
    lib/Cocos2dxActivity.java
    ```

* If you're using the prebuilt cocos2d-x libraries assuming you are in the `proj.android` directory, __Cocos2dxActivity.java__ is located:

    ```
    ./src/org/cocos2dx/lib/Cocos2dxActivity.java
    ```

  __Note:__ When using Cocos2d-x from source, different versions have __Cocos2dxActivity.java__ in a different location. One way to find the location is to look in __proj.android/project.properties__. Example:
  ```
  android.library.reference.1=../../cocos2d-x/cocos/platform/android/java
  ```

In this case, __Cocos2dxActivity.java__ should be located at:

</code></pre>

<p>../../cocos2d-x/cocos/platform/android/java/src/org/cocos2dx/lib/Cocos2dxActivity.java</p>
<pre><code>
* Modify __Cocos2dxActivity.java__ to add the following imports:
```java
import android.content.Intent;
import com.sdkbox.plugin.SDKBox;
</code></pre>

<ul>
<li>Second, modify <strong>Cocos2dxActivity.java</strong> to edit the <code>onCreate(final Bundle savedInstanceState)</code> function to add a call to <code>SDKBox.init(this);</code>. The placement of this call is important. It must be done after the call to <code>onLoadNativeLibraries();</code>. Example:</li>
</ul>
<pre><code class="java">onLoadNativeLibraries();
SDKBox.init(this);
</code></pre>

<ul>
<li>
<p>Last, we need to insert the proper <strong>overrides</strong> code. There are a few rules here.</p>
<ul>
<li>
<p>If the method listed has not been defined, <strong>add it</strong>.</p>
</li>
<li>
<p>If the method listed has been defined, add the calls to <code>SDKBox</code> in the <strong>same</strong> existing function.</p>
</li>
</ul>
</li>
</ul>
<pre><code class="java">    @Override
    protected void onActivityResult(int requestCode, int resultCode, Intent data) {
          if(!SDKBox.onActivityResult(requestCode, resultCode, data)) {
            super.onActivityResult(requestCode, resultCode, data);
          }
    }
    @Override
    protected void onStart() {
          super.onStart();
          SDKBox.onStart();
    }
    @Override
    protected void onStop() {
          super.onStop();
          SDKBox.onStop();
    }
    @Override
    protected void onResume() {
          super.onResume();
          SDKBox.onResume();
    }
    @Override
    protected void onPause() {
          super.onPause();
          SDKBox.onPause();
    }
    @Override
    public void onBackPressed() {
          if(!SDKBox.onBackPressed()) {
            super.onBackPressed();
          }
    }
</code></pre>

<h2 id="manual-integration-for-google-play-services-sdk-dependent-library-only">Manual Integration for Google Play Services SDK (dependent library only)</h2>
<h3 id="suggestion">Suggestion</h3>
<p>Please try the SDKBOX installer first. It will do all the following step for you automatically.</p>
<pre><code class="bash">$ sdkbox import googleplayservices
</code></pre>

<h3 id="modify-projectproperties">Modify <code>project.properties</code></h3>
<p>An <strong>Android Library Reference</strong> for <strong>Google Play Services</strong> is required. The
path will be different depending upon your setup. Also, this is an additional
download that does not come as part of a standard install. To install use the
<strong>sdk installer</strong> and choose <strong>extras-&gt;google play services</strong>. Here is an example of what this line could look like:</p>
<pre><code>android.library.reference.1=
../android/sdk.latest/extras/google/google_play_services/libproject/
google-play-services_lib
</code></pre>

<p><strong>Note:</strong> if you already have an <code>android.library.reference.1</code> you can add
another by incrementing the number as <code>android.library.reference.2</code>, etc.</p>
<h3 id="integration-manually">Integration manually</h3>
<p>We make a lite version of Google Play Services, the project repo is <a href="https://github.com/darkdukey/Google-Play-Service-Lite">https://github.com/darkdukey/Google-Play-Service-Lite</a></p>
<h4 id="copy-files_1">Copy Files</h4>
<p>Copy the <code>gps</code> folder from <code>plugin</code> folder of this bundle into your project’s <strong><project_root>/libs</strong> folder.</p>
<ul>
<li>
<p>If you're using cocos2d-x from source copy the <code>gps</code> folder to:</p>
<p>Android command-line:
<code>cocos2d/cocos/platform/android/java/libs</code></p>
<p>Android Studio:
<code>cocos2d/cocos/platform/android/libcocos2dx/libs</code></p>
</li>
<li>
<p>If you're using cocos2d-js or lua copy the <code>gps</code> folder to:</p>
<p>Android command-line:
<code>frameworks/cocos2d-x/cocos/platform/android/java/libs</code></p>
<p>Android Studio:
<code>frameworks/cocos2d-x/cocos/platform/android/libcocos2dx/libs</code></p>
</li>
<li>
<p>If you're using prebuilt cocos2d-x copy the <code>gps</code> folder to:</p>
<p>Android command-line:
<code>&lt;project_root&gt;/libs</code></p>
</li>
</ul>
<h4 id="modify-files-for-eclipse">Modify files for Eclipse</h4>
<ol>
<li>Modify project.properties</li>
</ol>
<pre><code># For source project
android.library.reference.2=../cocos2d/cocos/platform/android/java/libs/gps/

# Or
# For framework project
android.library.reference.1=libs/gps/
</code></pre>

<h4 id="modify-files-for-android-studio">Modify files for Android Studio</h4>
<h5 id="1-modify-cocos2dcocosplatformandroidlibcocos2dxbuildgradle">1. Modify cocos2d/cocos/platform/android/libcocos2dx/build.gradle</h5>
<pre><code> dependencies {
+    compile project(':gps')
     compile fileTree(dir: '../java/libs', include: ['*.jar'])
 }
</code></pre>

<h5 id="2-modify-projandroid-studioappprojectproperties">2. Modify proj.android-studio/app/project.properties</h5>
<pre><code> # Project target.
 target=android-10
+android.library.reference.1=../cocos2d/cocos/platform/android/java/libs/gps/
</code></pre>

<h5 id="3-modify-projandroid-studiosettingsgradle">3. Modify proj.android-studio/settings.gradle</h5>
<pre><code> project(':libcocos2dx').projectDir = new File(settingsDir, '../cocos2d/cocos/platform/android/libcocos2dx')
 include ':your_project_name'
 project(':your_project_name').projectDir = new File(settingsDir, 'app')
+
+include ':gps'
+project(':gps').projectDir = new File(settingsDir, '../cocos2d/cocos/platform/android/java/libs/gps')
</code></pre>

<h2 id="proguard-optional">Proguard (optional)</h2>
<ul>
<li>Edit <code>project.properties</code>  to specify a <code>Proguard</code> configuration file. Example:</li>
</ul>
<pre><code>proguard.config=proguard.cfg
</code></pre>

<ul>
<li>Edit the file you specified to include the following:</li>
</ul>
<pre><code># If your project uses WebView with JS, uncomment the following
# and specify the fully qualified class name to the JavaScript interface
# class:
#-keepclassmembers class fqcn.of.javascript.interface.for.webview {
#   public *;
#}

# cocos2d-x
-keep public class org.cocos2dx.** { *; }
-dontwarn org.cocos2dx.**
-keep public class com.chukong.** { *; }
-dontwarn com.chukong.**

# google play service
-keep public class com.google.android.gms.** { public *; }
-dontwarn com.google.android.gms.**

-keep class * extends java.util.ListResourceBundle {
    protected Object[][] getContents();
}

-keep public class com.google.android.gms.common.internal.safeparcel.SafeParcelable {
    public static final *** NULL;
}

-keepnames @com.google.android.gms.common.annotation.KeepName class *
-keepclassmembernames class * {
    @com.google.android.gms.common.annotation.KeepName *;
}

-keepnames class * implements android.os.Parcelable {
    public static final ** CREATOR;
}

#sdkbox
-keep public class com.sdkbox.** { *; }
-dontwarn com.sdkbox.**

# onesignal
-dontwarn com.onesignal.**

-keep class com.google.android.gms.common.api.GoogleApiClient {
    void connect();
    void disconnect();
}

-keep public interface android.app.OnActivityPausedListener {*;}

-keep class com.onesignal.shortcutbadger.impl.AdwHomeBadger { &lt;init&gt;(...); }
-keep class com.onesignal.shortcutbadger.impl.ApexHomeBadger { &lt;init&gt;(...); }
-keep class com.onesignal.shortcutbadger.impl.AsusHomeLauncher { &lt;init&gt;(...); }
-keep class com.onesignal.shortcutbadger.impl.DefaultBadger { &lt;init&gt;(...); }
-keep class com.onesignal.shortcutbadger.impl.NewHtcHomeBadger { &lt;init&gt;(...); }
-keep class com.onesignal.shortcutbadger.impl.NovaHomeBadger { &lt;init&gt;(...); }
-keep class com.onesignal.shortcutbadger.impl.SolidHomeBadger { &lt;init&gt;(...); }
-keep class com.onesignal.shortcutbadger.impl.SonyHomeBadger { &lt;init&gt;(...); }
-keep class com.onesignal.shortcutbadger.impl.XiaomiHomeBadger { &lt;init&gt;(...); }

</code></pre>

<p><strong>Note:</strong> Proguard only works with <strong>Release</strong> builds (i.e <code>cocos run -m release</code>) debug builds do not invoke Proguard rules.</p></div>
            
        </div>

        <footer class="col-md-12">
            <hr>
            
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>

        
        <script src="../../../js/jquery-1.10.2.min.js"></script>
        <script src="../../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../../js/highlight.pack.js"></script>
        <script>var base_url = '../../..';</script>
        <script src="../../../js/base.js"></script>
        

 
        
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-70044300-2', 'auto');
            ga('send', 'pageview');
        </script>
        
    </body>
</html>
