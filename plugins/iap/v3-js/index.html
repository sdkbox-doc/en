<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../../img/favicon.ico">

	<title>js - SDKBOX</title>

        <link href="../../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link href="../../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../../../css/highlight.css">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-62579154-2', 'sdkbox-doc.github.io/en');
            ga('send', 'pageview');
        </script>
        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="../../..">SDKBOX</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="../../..">Home</a>
                    </li>
                
                
                
                    <li >
                        <a href="../../../installer/">Installer</a>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Plugins <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">IAP</a>
    <ul class="dropdown-menu">
        
            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Cocos2dx 3.x</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../v3-cpp/">c++</a>
</li>

        
            
<li class="active">
    <a href="./">js</a>
</li>

        
            
<li >
    <a href="../v3-lua/">lua</a>
</li>

        
    </ul>
  </li>

        
            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Cocos2dx 2.x</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../v2-cpp/">c++</a>
</li>

        
            
<li >
    <a href="../v2-js/">js</a>
</li>

        
            
<li >
    <a href="../v2-lua/">lua</a>
</li>

        
    </ul>
  </li>

        
    </ul>
  </li>

                        
                            
<li >
    <a href="../../adcolony/">AdColony</a>
</li>

                        
                            
<li >
    <a href="../../chartboost/">Chartboost</a>
</li>

                        
                            
<li >
    <a href="../../vungle/">Vungle</a>
</li>

                        
                            
<li >
    <a href="../../googleanalytics/">Google Analytics</a>
</li>

                        
                            
<li >
    <a href="../../flurryanalytics/">Flurry Analytics</a>
</li>

                        
                            
<li >
    <a href="../../tune/">Tune</a>
</li>

                        
                            
<li >
    <a href="../../kochava/">Kochava</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li >
                        <a href="../../../release-note/">About</a>
                    </li>
                
                
                </ul>
            

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                
                    <li >
                        <a rel="next" href="../v3-cpp/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../v3-lua/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
                
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#overview">Overview</a></li>
        
    
        <li class="main "><a href="#integration">Integration</a></li>
        
    
        <li class="main "><a href="#extra-steps">Extra steps</a></li>
        
            <li><a href="#modify-cocos2dxactivityjava">Modify Cocos2dxActivity.java</a></li>
        
    
        <li class="main "><a href="#configuration">Configuration</a></li>
        
    
        <li class="main "><a href="#usage">Usage</a></li>
        
            <li><a href="#initialize-iap">Initialize IAP</a></li>
        
            <li><a href="#retrieve-latest-product-data">Retrieve latest Product data</a></li>
        
            <li><a href="#make-a-purchase">Make a purchase</a></li>
        
            <li><a href="#restore-purchase">Restore purchase</a></li>
        
            <li><a href="#handling-purchase-events">Handling Purchase Events</a></li>
        
    
        <li class="main "><a href="#api-reference">API Reference</a></li>
        
            <li><a href="#methods">Methods</a></li>
        
            <li><a href="#listeners">Listeners</a></li>
        
    
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<!--
Include Base: /Users/niteluo/Projects/store/doc/en/src/iap/v3-cpp
-->

<h2 id="overview">Overview</h2>
<p>Provides you one stop solution for IAP integration across multiple platform, SDKBOX IAP offers easy to use yet powerful API, really simplify the tedious process of implementing IAPs in your game.</p>
<h2 id="integration">Integration</h2>
<p>Use the following command to install SDKBOX IAP plugin, Make sure you setup SDKBOX installer correctly.</p>
<pre><code class="bash">sdkbox import -b iap
</code></pre>

<h2 id="extra-steps">Extra steps</h2>
<h3 id="modify-cocos2dxactivityjava">Modify <code>Cocos2dxActivity.java</code></h3>
<ul>
<li>
<p><code>Cocos2dxActivity.java</code> is located:</p>
<p><code>/frameworks/js-bindings/cocos2d-x/cocos/platform/android/java/src/org/
cocos2dx/lib/Cocos2dxActivity.java</code></p>
</li>
<li>
<p>Modify <code>Cocos2dxActivity.java</code> to add the following imports:</p>
</li>
</ul>
<pre><code class="java">import android.content.Intent;
import com.sdkbox.plugin.SDKBox;
</code></pre>

<ul>
<li>Second, modify <code>Cocos2dxActivity</code> to edit the <code>onCreate(final Bundle savedInstanceState)</code> function to add a call to <code>SDKBox.init(this);</code>. The placement of this call is important. It must be done after the call to <code>onLoadNativeLibraries();</code>. Example:</li>
</ul>
<pre><code class="java">onLoadNativeLibraries();
SDKBox.init(this);
</code></pre>

<ul>
<li>
<p>Last, we need to insert the proper <strong>overrides</strong> code. There are a few rules here.</p>
<ul>
<li>
<p>If the method listed has not been defined, <strong>add it</strong>.</p>
</li>
<li>
<p>If the method listed has been defined, add the calls to <code>SDKBox</code> in the <strong>same</strong> existing function.</p>
</li>
</ul>
</li>
</ul>
<pre><code class="java">    @Override
    protected void onActivityResult(int requestCode, int resultCode, Intent data) {
          if(!SDKBox.onActivityResult(requestCode, resultCode, data)) {
            super.onActivityResult(requestCode, resultCode, data);
          }
    }
    @Override
    protected void onStart() {
          super.onStart();
          SDKBox.onStart();
    }
    @Override
    protected void onStop() {
          super.onStop();
          SDKBox.onStop();
    }
    @Override
    protected void onResume() {
          super.onResume();
          SDKBox.onResume();
    }
    @Override
    protected void onPause() {
          super.onPause();
          SDKBox.onPause();
    }
    @Override
    public void onBackPressed() {
          if(!SDKBox.onBackPressed()) {
            super.onBackPressed();
          }
    }
</code></pre>

<h2 id="configuration">Configuration</h2>
<p>SDKBOX Installer will automatically inject a sample configuration to your <code>sdkbox_config.json</code>, that you have to modify it before you can use it for your own app</p>
<p>Here is an example of IAP configuration, you need to replace <code>&lt;put the product id for ios here&gt;</code> with the product id from your <a href="http://itunesconnect.apple.com">iTunes Connect</a> or <a href="https://play.google.com/apps/publish">Google Play Console</a></p>
<pre><code class="json">&quot;ios&quot; :
{
    &quot;iap&quot;:{
        &quot;items&quot;:{
            &quot;remove_ads&quot;:{
                &quot;id&quot;:&quot;&lt;put the product id for ios here&gt;&quot;
            }
        }
    }
},
&quot;android&quot;:
{
    &quot;iap&quot;:{
        &quot;key&quot;:&quot;put your googleplay key here&quot;,
        &quot;items&quot;:{
          &quot;remove_ads&quot;:{
              &quot;id&quot;:&quot;&lt;put the product id for android here&gt;&quot;
          }
        }
    }
}
</code></pre>

<h2 id="usage">Usage</h2>
<h3 id="initialize-iap">Initialize IAP</h3>
<ul>
<li>
<p>Call <code>sdkbox.IAP.init();</code> where appropriate in your code. We
recommend to do this in the <code>app.js</code></p>
</li>
<li>
<p>Modify <code>AppDelegate.cpp</code> to include the following headers:</p>
</li>
</ul>
<pre><code class="cpp">#include &quot;PluginIAPJS.hpp&quot;
#include &quot;PluginIAPJSHelper.hpp&quot;
</code></pre>

<ul>
<li>Modify <code>AppDelegate.cpp</code> make sure to call:</li>
</ul>
<pre><code class="cpp">sc-&gt;addRegisterCallback(register_all_PluginIAPJS);
sc-&gt;addRegisterCallback(register_all_PluginIAPJS_helper);
</code></pre>

<p>This registers the Javascript callbacks.</p>
<h3 id="retrieve-latest-product-data">Retrieve latest Product data</h3>
<p>It's always a good idea to retrieve the latest product data from store when your game starts.</p>
<p>To retrieve latest IAP data, simply call <code>sdkbox.IAP.refresh()</code>.</p>
<blockquote>
<p><code>onProductRequestSuccess</code> if retrieved successfully.</p>
<p><code>onProductRequestFailure</code> if exception occurs.</p>
</blockquote>
<h3 id="make-a-purchase">Make a purchase</h3>
<p>To make a purchase call <code>sdkbox.IAP.purchase(name)</code></p>
<p><strong>Note:</strong> <strong>name</strong> is the name of the IAP item in your config file under <code>items</code> tag, not the product id you set in iTunes or GooglePlay Store</p>
<blockquote>
<p><code>onSuccess</code> will be triggered if purchase is successful.</p>
<p><code>onFailure</code> will be triggered if purchase fails.</p>
<p><code>onCanceled</code> will be triggered if purchase is canceled by user.</p>
</blockquote>
<h3 id="restore-purchase">Restore purchase</h3>
<p>To restore purchase call <code>sdkbox.IAP.restore()</code>.</p>
<blockquote>
<p><code>onRestored</code> will be triggered if restore is successful.</p>
</blockquote>
<p><strong>Note:</strong> <code>onRestored</code> could be triggered multiple times</p>
<h3 id="handling-purchase-events">Handling Purchase Events</h3>
<p>This allows you to catch the <code>IAP</code> events so that you can perform operations based upon the response from your players and IAP servers.</p>
<pre><code class="Javascript">sdkbox.IAP.setListener({
    onSuccess : function (product) {
        //Purchase success
    },
    onFailure : function (product, msg) {
        //Purchase failed
        //msg is the error message
    },
    onCanceled : function (product) {
        //Purchase was canceled by user
    },
    onRestored : function (product) {
        //Purchase restored
    },
    onProductRequestSuccess : function (products) {
        //Returns you the data for all the iap products
        //You can get each item using following method
        for (var i = 0; i &lt; products.length; i++) {
            // loop
        }
    },
    onProductRequestFailure : function (msg) {
        //When product refresh request fails.
    }
});
</code></pre>

<h2 id="api-reference">API Reference</h2>
<h3 id="methods">Methods</h3>
<pre><code class="javascript">sdkbox.IAP.init();
</code></pre>

<blockquote>
<p>Initialize SDKBox IAP</p>
</blockquote>
<pre><code class="javascript">sdkbox.IAP.setDebug(debug);
</code></pre>

<blockquote>
<p>Enable/disable debug logging</p>
</blockquote>
<pre><code class="javascript">sdkbox.IAP.purchase(name);
</code></pre>

<blockquote>
<p>Make a purchase request</p>
</blockquote>
<pre><code class="javascript">sdkbox.IAP.refresh();
</code></pre>

<blockquote>
<p>Refresh the IAP data(title, price, description)</p>
</blockquote>
<pre><code class="javascript">sdkbox.IAP.restore();
</code></pre>

<blockquote>
<p>Restore purchase</p>
</blockquote>
<pre><code class="javascript">sdkbox.IAP.setListener(listener);
</code></pre>

<blockquote>
<p>Set listener for IAP</p>
</blockquote>
<pre><code class="javascript">sdkbox.IAP.removeListener();
</code></pre>

<blockquote>
<p>Remove listener for IAP</p>
</blockquote>
<h3 id="listeners">Listeners</h3>
<pre><code class="javascript">sdkbox.IAP.onSuccess(product);
</code></pre>

<blockquote>
<p>Called when an IAP processed successfully</p>
</blockquote>
<pre><code class="javascript">sdkbox.IAP.onFailure(product, message);
</code></pre>

<blockquote>
<p>Called when an IAP fails</p>
</blockquote>
<pre><code class="javascript">sdkbox.IAP.onCanceled(product);
</code></pre>

<blockquote>
<p>Called when user canceled the IAP</p>
</blockquote>
<pre><code class="javascript">sdkbox.IAP.onRestored(product);
</code></pre>

<blockquote>
<p>Called when server returns the IAP items user already purchased</p>
</blockquote>
<pre><code class="javascript">sdkbox.IAP.onProductRequestSuccess(products);
</code></pre>

<blockquote>
<p>Called the product request is successful, usually developers use product request to update the latest info(title, price) from IAP</p>
</blockquote>
<pre><code class="javascript">sdkbox.IAP.onProductRequestFailure(message);
</code></pre>

<blockquote>
<p>Called when the product request fails</p>
</blockquote></div>
            
        </div>

        <footer class="col-md-12">
            <hr>
            
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>

        <script src="../../../js/jquery-1.10.2.min.js"></script>
        <script src="../../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../../js/highlight.pack.js"></script>
        <script>var base_url = '../../..';</script>
        <script data-main="../../../mkdocs/js/search.js" src="../../../mkdocs/js/require.js"></script>
        <script src="../../../js/base.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                    </div>
                    <div class="modal-body">
                        <p>
                            From here you can search these documents. Enter
                            your search terms below.
                        </p>
                        <form role="form">
                            <div class="form-group">
                                <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                            </div>
                        </form>
                        <div id="mkdocs-search-results"></div>
                    </div>
                    <div class="modal-footer">
                    </div>
                </div>
            </div>
        </div>

    </body>
</html>
